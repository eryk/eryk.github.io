<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xuqi365.com","root":"/","scheme":"Gemini","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Python量化交易实战">
<meta property="og:url" content="http://xuqi365.com/index.html">
<meta property="og:site_name" content="Python量化交易实战">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="eryk">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://xuqi365.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Python量化交易实战</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Python量化交易实战" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Python量化交易实战</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xuqi365.com/2020/12/27/2020-12-27%20Python%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90%E6%A8%A1%E5%9D%97%EF%BC%9Amissingno/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Python量化交易实战">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/27/2020-12-27%20Python%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90%E6%A8%A1%E5%9D%97%EF%BC%9Amissingno/" class="post-title-link" itemprop="url">Pandas缺失值可视化分析模块：missingno</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-12-27 22:51:33 / 修改时间：23:22:51" itemprop="dateCreated datePublished" datetime="2020-12-27T22:51:33+08:00">2020-12-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>missingno提供了一个灵活且易于使用的丢失数据可视化工具和实用程序的小型工具集，使您可以快速直观地概述数据集的完整性（或缺乏完整性）。只需pip install missingno就可以开始使用了</p>
<p>missingno包含了4种类型图示：</p>
<ol>
<li>
<p>Metrix：msno.matrix无效矩阵是一种数据密集显示图，可以直观的看到各个column缺失数据分布情况，这种可视化图示最多可以容纳50个column，超过此范围的标签开始重叠或变得不可读。<br>
<img src="https://raw.githubusercontent.com/eryk/blog_img/master/20201227231432.png" alt=""></p>
</li>
<li>
<p>Bar：msno.bar是按列对无效性数据的简单可视化：</p>
<p><img src="https://raw.githubusercontent.com/eryk/blog_img/master/20201227231524.png" alt=""></p>
</li>
<li>
<p>Heatmap：数据列之前缺失相关性分析图，展示了一个变量的存在或不存在对另一个变量的存在有多强烈的影响</p>
<p><img src="https://raw.githubusercontent.com/eryk/blog_img/master/20201227231600.png" alt=""></p>
</li>
<li>
<p>Dendrogram：通过树状图，您可以更全面地关联变量完成，揭示比Heatmap中可见的成对趋势更深的趋势。与metrix图一样，在这种配置下最多只能显示50个带标签的列。但是，树状图只需翻转到水平配置即可更优雅地处理超大型数据集。</p>
<p><img src="https://raw.githubusercontent.com/eryk/blog_img/master/20201227231612.png" alt=""></p>
</li>
</ol>
<h3 id="参考">参考</h3>
<p><a href="https://github.com/ResidentMario/missingno" target="_blank" rel="noopener">https://github.com/ResidentMario/missingno</a></p>

      

<img src="https://eryk.github.io/uploads/gzh.jpg"  alt="Python量化交易实战" /><center>欢迎您扫码订阅我的微信公众号: pyquant</center>
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xuqi365.com/2020/12/20/2020-12-20%20%E6%8A%95%E8%B5%84%E8%91%97%E4%BD%9C%E5%93%81%E8%AF%BB1%EF%BC%9A%E3%80%8A%E4%BB%A5%E4%BA%A4%E6%98%93%E4%B8%BA%E7%94%9FII:%E5%8D%96%E5%87%BA%E7%9A%84%E8%89%BA%E6%9C%AF%E3%80%8B%E4%B8%AD%E7%9A%84%E7%B2%BE%E5%8D%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Python量化交易实战">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/20/2020-12-20%20%E6%8A%95%E8%B5%84%E8%91%97%E4%BD%9C%E5%93%81%E8%AF%BB1%EF%BC%9A%E3%80%8A%E4%BB%A5%E4%BA%A4%E6%98%93%E4%B8%BA%E7%94%9FII:%E5%8D%96%E5%87%BA%E7%9A%84%E8%89%BA%E6%9C%AF%E3%80%8B%E4%B8%AD%E7%9A%84%E7%B2%BE%E5%8D%8E/" class="post-title-link" itemprop="url">投资著作品读1：《以交易为生II:卖出的艺术》中的精华</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-12-20 22:34:00 / 修改时间：22:38:59" itemprop="dateCreated datePublished" datetime="2020-12-20T22:34:00+08:00">2020-12-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%95%E8%B5%84%E8%91%97%E4%BD%9C%E5%93%81%E8%AF%BB/" itemprop="url" rel="index">
                    <span itemprop="name">投资著作品读</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近重读了这本经典的金融投资类书籍，把其中精华部分摘录的下来，除了摘录的部分，第三章内容介绍的交易日志介绍了如何给一笔交易打分也不错，作者让我们更多的关注一笔交易的好坏，而不仅仅是盯住账户盈亏，这样日积月累交易技术才会精进。以下是本书精华部分，介绍了多种卖出的目的与技术。</p>
<h1>第二部分 如何卖出</h1>
<p>卖出策略分为下列三种：</p>
<ol>
<li>止盈卖出</li>
<li>保护性止损卖出</li>
<li>在止盈或止损之间卖出，因为市场状况变化了，我们接下来不再希望持有这只股票</li>
</ol>
<h2 id="第四章-止盈">第四章 止盈</h2>
<ol>
<li>你的止盈价是多少—这只股票可能会涨多少？</li>
<li>股票跌多少你才会相信你的买入决策是错误的，并止损。</li>
<li>这只股票的期望损益比是多少？潜在的收益和风险之间的关系是什么？</li>
</ol>
<p>对波段交易者来说，使用移动平均线和通道组合是设置目标价的好方法。如果要设立长期交易的盈利目标，就需要查看长期的支撑和压力在哪里。</p>
<h3 id="移动平均线卖出">移动平均线卖出</h3>
<p>周线图中，在价值之下买入，把盈利目标设置在价值区，这个方法非常好用。三重过滤网系统要求在周K线做出战略决策，在日K线实施，日线是做战术性买入或卖出的时间框架。</p>
<h3 id="使用通道技术卖出">使用通道技术卖出</h3>
<p>如果使用通道技术给交易设定了盈利目标，但后来你觉得反弹高度会更高一些怎么办？你可能会持有多长时间？尽管价格有时候会反弹得很高，它容易让人放弃先前的决定而持有更长时间，但经验告诉我不要持有头寸时间过久。</p>
<p>如果价格比你设定的初始目标价低一些，你会获利了结吗？当这个问题摆在我面前的时候，我就等价格创新高失败的那天以收盘价卖出，或者在次日开盘后不久卖出。</p>
<h3 id="压力位卖出">压力位卖出</h3>
<p>移动平均线卖出法适用于股票超卖后的反弹，通道卖出法适合短线交易者使用，这些方法可以用于短期波段交易。短期交易的波动幅度相对于长期交易者来说太小，我们曾把长线交易者称为投资者，但世界在变快，每个人又都是交易者。长线交易者的交易周期以月甚至年来衡量，这需要更大的盈利目标。猎鹿的人与猎兔子的人不同，猎鹿的人需要一杆大枪。</p>
<p>支撑和压力区的存在为长线交易者提供了盈利目标。我们把大量交易发生过的地方作为压力或支撑区，这样就很容易知道相对于压力或支撑，价格目前所处的位置。</p>
<p>每开始一次交易，你都应该有两个目标：赚钱和变成更好的交易者。你不一定每次都达到第一个目标，但必须达到第二个目标。如果没有从交易中学到什么，你就是在浪费时间和金钱。</p>
<h2 id="第五章-止损">第五章 止损</h2>
<p>每次交易都应该设定止损。请务必遵循这个简单的规则：在确切地知道止损位置之前，不要交易。入场前你必须做出这个决策，当然你还应该确立一个盈利目标以计算损益比。没有目标的交易无异于赌博。</p>
<h3 id="铁三角止损">铁三角止损</h3>
<p>设立止损的首要目的是避免情势不利时损失超过预期，第二个目的是保护浮盈，第三个目的毫无疑问是控制与资金管理有密切关系的总资金亏损。</p>
<p>风险控制工作的过程分三个步骤：</p>
<ol>
<li>
<p>分析并设定止损位，通过入场价与止损价之间的距离计算每股风险损失值。</p>
<p>假如准备以18美元/每股的价格买入股票，分析后发现如果股价跌破17美元就改变看多观点，所以你决定把保护性止损设在16.89美元。每股风险值是1.11美元，如果加上滑点的话每股风险值会更高一点，但是1.11美元已经是一个合理的估计值了。</p>
</li>
<li>
<p>运用资金管理规则确定单次交易的最大损失额度以及交易者所能承受的风险值。</p>
<p>假设你的交易账户有5万美元，并遵循2%的资金管理规则。这意味着你每次交易的最大风险值是1000美元，这个风险值也比较适中，实际中不少人希望止损小于1%。</p>
</li>
<li>
<p>根据1和2中的数据计算可购入的最大股票数量。</p>
<p>这样就可以计算得出单次交易所能购入的最大股票数量。如果单次交易最大风险值是1000美元，每股允许的风险值是1.11美元，最大的交易股数应该小于900股；另外这1000美元中必须包括交易佣金和滑点。还有一点，没有人规定你必须交易最大可购入的股数，如果你觉得风险仍然太大，可以交易比这个数量更少的股票。如果你对这只18美元的股票抱有很大期望，就应该把止损空间设得大一些，比如在15.89美元，然后每股允许的风险值将会是2.11美元；单次交易的最大损失值不变，因此你最多可购入的股票数量就只有470股了。</p>
</li>
</ol>
<h3 id="市价止损和限价止损">市价止损和限价止损</h3>
<p>市价指令可以保证执行，但不能保证价格；限价指令保证价格但不能保证一定会执行。</p>
<h3 id="硬止损和软止损">硬止损和软止损</h3>
<p>硬止损是下到市场中的止损指令，软止损是交易者牢记的止损价格，只要市场价格达到止损价格，就立即下单。</p>
<h3 id="糟糕的止损位">糟糕的止损位</h3>
<p>关于止损的最糟糕的认识是，只要价格低于最近的最低价就立即止损</p>
<h3 id="止损设在前低上：减少滑点">止损设在前低上：减少滑点</h3>
<p>把止损点设在前期低点上而不是低于前期低点一个Tick的地方。看了很多图表后我发现，很少有股票在价格跌到前低的时候停下脚步，它们往往跌破前低。正常情况下，价格不是到不了前低就是跌破前低，这表明把止损设在低于前低一个Tick的位置上对交易安全没有帮助，所以我开始把止损设在前低的位置上。</p>
<h3 id="尼克止损法">尼克止损法</h3>
<p>寻找大多数人设置止损的价格，然后找出跌破该价格的K线，并把止损设在两个次低价中较低的那个价格之下。这种紧随的设置止损方法非常适合短期波段交易，试图抓住底部是很危险的，而这样一个紧随性止损却会很好地保护账户，这就像告诉市场，要么来打我止损（反正止损不大），要么就给我涨。</p>
<h3 id="使用宽幅止损的时机">使用宽幅止损的时机</h3>
<p>交易周期影响止损大小，较短时间框架内的交易止损必须小，而长周期框架的交易要求止损大一些。短期时间框架内的价格运动先于长期时间框架内的价格运动。</p>
<h3 id="移动止损">移动止损</h3>
<ul>
<li>可以用K线组合的低点作为新的止损点，比如把止损移动到最近三根K线最低价的位置（但决不要和交易方向相反）。</li>
<li>可以使用周期非常短的移动平均线，并把均线值作为追踪止损值。</li>
<li>可以使用枝形灯止损法，市场每次创新高都从最高点起算，以特定的距离向上移动止损，这个距离的计算应基于ATR（真实波幅）。只要股价创新高，就把止损向上移一定距离，这种方式就像从天花板上挂一盏枝形灯（本方法已经在《走进我的交易室》中介绍过）。</li>
<li>抛物线止损。</li>
<li>安全区止损。</li>
<li>回撤比例止损。</li>
<li>时间止损，如果在一定时间内价格没有变化就止损。比如做一笔日内交易，如果股价在10～15分钟内明显没有按照你的预期变化，那么最好了结这次交易；如果做一笔波段交易并预计股价会持续好几个交易日，但是一周过去了股价仍在横盘整理。这表明价格没有确认你的判断，安全的做法是赶紧出局。</li>
</ul>
<h3 id="抛物线止损指标">抛物线止损指标</h3>
<p>今日SAR=前一日SAR+AF×（EP–前一日SAR）</p>
<p>其中，今日SAR=今日止损价；</p>
<p>EP=当前交易中到达过的极点，如果看多，EP就表示近期明显的低点；如果看空，EP就表示近期明显的高点；</p>
<p>AF=加速因子。</p>
<p>交易的第一天加速因子等于0.02，表示你必须把止损设在近期极值的2%处；只要价格创下新高或新低，加速因子就增加0.02，加速因子的最大值是0.2。</p>
<p>抛物线系统在趋势行情中运行很好，但在震荡行情中却频频失灵。另外，不要在计算机自动交易中使用这个系统。</p>
<h3 id="安全区止损">安全区止损</h3>
<p>安全区止损的理念来源于金融市场中的信号和噪音，如果趋势是信号，那么回调就是噪音。</p>
<p>我们可以用多种方法定义趋势，比较简单且直接的方法是用价格与22天EMA的相对位置来定义趋势。在涨势中我们把噪音定义为今日价格中低于前一天低点的部分，这部分与趋势相反；如果是跌势我们把噪音定义为今日价格中高于前一天高点的部分。交易者需要决定测量噪音的回测期的长度，回测期不能太长但必须对交易有实质意义，只需日线图中最近一个月左右的数据就可以了</p>
<p>如果在上涨趋势中把所有噪音部分标出来并汇总，除以噪音发生的总次数，就得出回测期的噪音均值，它反映了当前上升趋势中的平均噪音水平。把止损设得太近容易弄巧成拙，所以要把止损设在远离噪音均值的地方，用噪音均值乘以平均噪音系数（初始值为2，也可用大于2的数值），用昨天最低价减去上面的这个计算结果就得出了止损应该设置的地方。如果今天的最低值比昨天低就不移动止损，这种方法只允许将止损向上移动。</p>
<p>下跌趋势与上涨趋势的规则相反。当22日EMA均线显示目前处于下跌趋势，计算回测期噪音均值并乘以系数，用昨日最高价加上上述数值，就得出今日的止损设置位置。同样，止损只向下移动不向上移动。</p>
<h3 id="波幅减少追踪止损法">波幅减少追踪止损法</h3>
<p>如果市场即将疯狂并大幅移动，我自然愿意留在市场中。我使用通道设置价格目标，通道宽度的正常值是2.7倍标准差。如果我想在价格达到目标价以后使用追踪止损，我会把止损设在1.7倍标准差的地方，只要价格继续沿着正常通道运动我就一直持有，但只要收盘价在1.7倍标准差这个通道内我就离场。通道宽度可以用修改通道参数的方法来修改。</p>
<h3 id="如何决定在价格达到盈利目标时是获利了结还是使用追踪止损？">如何决定在价格达到盈利目标时是获利了结还是使用追踪止损？</h3>
<p>如果价格到达盈利目标并且看到顶背离信号，我就不用追踪止损；只要看到不利的价格运动，比如长上影伴随巨大的成交量，我会在盈利目标位获利了结；如果市场运行良好，并且底部一次比一次高，我就使用追踪止损方法。在价格到达盈利目标后，只有看到足够积极的价格信号我才会使用追踪止损。</p>
<h3 id="盈利目标转换为追踪止损的使用频率是多少？">盈利目标转换为追踪止损的使用频率是多少？</h3>
<p>我在2/3的交易中都使用这种方法，但用得不是很好。有时候刚刚设定了追踪止损，5分钟后就被扫出局。大约有一半时间追踪止损法给我带来比原先更多的利润，大的获益极少，主要来自大行情中。</p>

      

<img src="https://eryk.github.io/uploads/gzh.jpg"  alt="Python量化交易实战" /><center>欢迎您扫码订阅我的微信公众号: pyquant</center>
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xuqi365.com/2020/12/13/2020-12-13%20%E4%B8%80%E4%B8%AAPandas%20MultiIndex%E7%B4%A2%E5%BC%95%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Python量化交易实战">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/13/2020-12-13%20%E4%B8%80%E4%B8%AAPandas%20MultiIndex%E7%B4%A2%E5%BC%95%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">Pandas MultiIndex索引使用问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-12-13 16:54:00 / 修改时间：17:53:59" itemprop="dateCreated datePublished" datetime="2020-12-13T16:54:00+08:00">2020-12-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于MultiIndex的资料并不太多，<a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html" target="_blank" rel="noopener">官方文档</a>链接请点这里查看。</p>
<p>最近在使用MultiIndex时遇到的一个问题，先描述一下数据格式。我使用MultiIndex DataFrame来存储股票未来N天的收益率，变量命名为returns，数据样例如下，columns 1d和5d分别表示未来1天和5天的股票收益率，index为MultiIndex，第一级索引为日期，第二级索引为股票代码。</p>
<pre><code>                              1d        5d
2005-01-04 000001.XSHE -0.009202  0.010736
           000002.XSHE  0.036053  0.045541
           000004.XSHE  0.020896  0.068657
           000005.XSHE  0.023474  0.098592
           000006.XSHE  0.014286  0.178571
...                          ...       ...
2020-12-11 688600.XSHG       NaN       NaN
           688777.XSHG       NaN       NaN
           688788.XSHG       NaN       NaN
           688981.XSHG       NaN       NaN
           689009.XSHG       NaN       NaN
</code></pre>
<p>对returns用start=‘2020-01-01’、end='2020-12-11’起止时间做了截断处理，代码片段如下：</p>
<pre><code>returns_index = returns.index.get_level_values(level=0)
returns = returns.loc[(returns_index &gt; pd.to_datetime(start)) &amp; (returns_index &lt; pd.to_datetime(end))]
</code></pre>
<p>这样获取的数据是从2020年开始的，但是使用returns.index.levels[0]发现数据还是从2005年开始的</p>
<pre><code>returns.index.levels[0]
DatetimeIndex(['2005-01-04', '2005-01-05', '2005-01-06', '2005-01-07',
               '2005-01-10', '2005-01-11', '2005-01-12', '2005-01-13',
               '2005-01-14', '2005-01-17',
               ...
               '2020-11-30', '2020-12-01', '2020-12-02', '2020-12-03',
               '2020-12-04', '2020-12-07', '2020-12-08', '2020-12-09',
               '2020-12-10', '2020-12-11'],
              dtype='datetime64[ns]', length=3875, freq=None)
</code></pre>
<p>想了想，应该是由于index索引不可变，这里需要重建MultiIndex DataFrame，需要用到pandas.MultiIndex.remove_unused_levels() 方法先删除掉index里多余的信息，然后再重新创建MultiIndex DataFrame，代码如下：</p>
<pre><code class="language-python">tmp = returns.index.remove_unused_levels()
tmp = returns.index.remove_unused_levels()
returns = pd.DataFrame(returns, tmp)
returns.index.levels[0]
</code></pre>
<pre><code>DatetimeIndex(['2020-01-02', '2020-01-03', '2020-01-06', '2020-01-07',
               '2020-01-08', '2020-01-09', '2020-01-10', '2020-01-13',
               '2020-01-14', '2020-01-15',
               ...
               '2020-11-27', '2020-11-30', '2020-12-01', '2020-12-02',
               '2020-12-03', '2020-12-04', '2020-12-07', '2020-12-08',
               '2020-12-09', '2020-12-10'],
              dtype='datetime64[ns]', length=228, freq=None)
</code></pre>
<p>看输出结果已经获取到了正确的时间范围内的数据。</p>

      

<img src="https://eryk.github.io/uploads/gzh.jpg"  alt="Python量化交易实战" /><center>欢迎您扫码订阅我的微信公众号: pyquant</center>
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xuqi365.com/2020/12/09/2020-12-09%20%E4%B8%80%E4%B8%AAPandas%E7%B4%A2%E5%BC%95%E7%94%9F%E6%88%90%E7%9A%84%E5%B0%8F%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Python量化交易实战">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/09/2020-12-09%20%E4%B8%80%E4%B8%AAPandas%E7%B4%A2%E5%BC%95%E7%94%9F%E6%88%90%E7%9A%84%E5%B0%8F%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">一个Pandas索引生成的小问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-09 17:13:00" itemprop="dateCreated datePublished" datetime="2020-12-09T17:13:00+08:00">2020-12-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-10 10:17:16" itemprop="dateModified" datetime="2020-12-10T10:17:16+08:00">2020-12-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天遇到一个Pandas索引生成的问题，需要根据股票日频数据生成1分钟间隔的index，想了3个方法来生成：</p>
<p>方法1: 如果有1分钟bar数据的话可以直接读取数据获取index值，可惜没有哈</p>
<p>方法2: pandas.date_range，这个方法可以生成一个时间序列，设置参数<strong>freq</strong>=‘1min’ ，但是这样生成的结果包含了非交易时间段的数据，运行试了下速度也比较慢。</p>
<p>方法3: 两个list循环，第一个list是日期数据，第二个list是交易时间段的1分钟间隔数据，这个办法虽然笨点但是运行速度还挺快的，具体方法如下：</p>
<pre><code class="language-python">import itertools

import tushare as ts
import pandas as pd

pro = ts.pro_api()
df = ts.pro_bar(ts_code='000001.SZ', adj='hfq', start_date='20200101', end_date='20201209')
df.index = pd.to_datetime(df['trade_date'])
df.sort_index(inplace=True)

times = [d.strftime('%H:%M:%S') for d in
         pd.date_range('09:30:00', '11:30:00', closed='right', freq=('{}min'.format(1)))] + [
            d.strftime('%H:%M:%S') if d.strftime('%H:%M:%S') != '13:00:00' else '11:30:00' for d in
            pd.date_range('13:00:00', '15:00:00', closed='right', freq=('{}min'.format(1)))]

tmp = [str(item[0])[:10] + ' ' + item[1] for item in itertools.product(list(df.index), times)]
min1_index = pd.to_datetime(tmp)
print(min1_index)
</code></pre>
<p>输出结果如下：</p>
<pre><code class="language-python">DatetimeIndex(['2020-01-02 09:31:00', '2020-01-02 09:32:00',
               '2020-01-02 09:33:00', '2020-01-02 09:34:00',
               '2020-01-02 09:35:00', '2020-01-02 09:36:00',
               '2020-01-02 09:37:00', '2020-01-02 09:38:00',
               '2020-01-02 09:39:00', '2020-01-02 09:40:00',
               ...
               '2020-12-09 14:51:00', '2020-12-09 14:52:00',
               '2020-12-09 14:53:00', '2020-12-09 14:54:00',
               '2020-12-09 14:55:00', '2020-12-09 14:56:00',
               '2020-12-09 14:57:00', '2020-12-09 14:58:00',
               '2020-12-09 14:59:00', '2020-12-09 15:00:00'],
              dtype='datetime64[ns]', length=54480, freq=None)
</code></pre>

      

<img src="https://eryk.github.io/uploads/gzh.jpg"  alt="Python量化交易实战" /><center>欢迎您扫码订阅我的微信公众号: pyquant</center>
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xuqi365.com/2020/11/29/2020-11-29%20Quantopian%E6%8A%95%E8%B5%84%E7%BB%84%E5%90%88%E5%92%8C%E7%BB%A9%E6%95%88%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%9APyfolio/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Python量化交易实战">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/29/2020-11-29%20Quantopian%E6%8A%95%E8%B5%84%E7%BB%84%E5%90%88%E5%92%8C%E7%BB%A9%E6%95%88%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%9APyfolio/" class="post-title-link" itemprop="url">Quantopian投资组合和绩效分析工具：Pyfolio</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-29 09:53:00 / 修改时间：16:58:31" itemprop="dateCreated datePublished" datetime="2020-11-29T09:53:00+08:00">2020-11-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index">
                    <span itemprop="name">量化交易系统</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="介绍">介绍</h3>
<p>pyfolio是由Quantopian开发的Python库，用于对金融投资组合进行绩效和风险分析。它与Zipline开源回溯测试库配合使用良好。<br>
pyfolio的核心是所谓的“tear sheet ”，它由各种单独的图组成，这些图提供了交易算法性能的全面图像展示。</p>
<h3 id="入门示例">入门示例</h3>
<p>这里以双均线策略来做演示，当20日均线上穿40日均线买入股票，当20日均线下穿40日均线则卖出股票，首先我们通过tushare获取股票历史数据</p>
<pre><code class="language-python">import pandas as pd
import numpy as np
import tushare as ts
import pyfolio as pf

pro = ts.pro_api()
df = ts.pro_bar(ts_code='000001.SZ', adj='hfq', start_date='20150101', end_date='20191231')
df.index = pd.to_datetime(df['trade_date'])
df.sort_index(inplace=True)
</code></pre>
<p>接下来生成策略信号</p>
<pre><code class="language-python">df['ma20'] = df['close'].rolling(20).mean()
df['ma40'] = df['close'].rolling(40).mean()
# 计算20日均线和40日均线的距离
df['diff'] = df['ma20'] - df['ma40']
# 当diff值大于0买入股票，当diff值小于0卖出股票
df['signal'] = np.where(df['diff'] &gt; 0, 1, 0)
df['signal'] = np.where(df['diff'] &lt; 0, 0, df['signal'])
# 计算策略每日收益，这里计算每日收益使用log函数，signal计算由于使用了当天的收盘价，所以需要shift 1天，否则会用到未来数据
df['strategy'] = np.log(df['close'] / df['close'].shift(1)) * df['signal'].shift(1)
# 计算资产收益率
df['equity'] = df['strategy'].cumsum() + 1
</code></pre>
<p>展示资产收益率曲线，这里对股价做了归一化处理以便数据展示，可以看到双均线策略不仅跑赢股价，并且资金曲线回撤相对较小。</p>
<pre><code class="language-python">df['close_norm'] = df['close'] / float(df['close'][0])
df[['close_norm','equity']].plot(figsize=(12,6))
</code></pre>
<p><img src="https://raw.githubusercontent.com/eryk/blog_img/master/1.png" alt=""></p>
<p>上图看到的信息有限，接下来是使用pyfolio工具对投资回报进一步分析，代码如下:</p>
<pre><code class="language-python">pf.create_full_tear_sheet(df['strategy'], benchmark_rets=np.log(df['close'] / df['close'].shift(1)))
</code></pre>
<p>首先是返回汇总信息：</p>
<p><img src="https://raw.githubusercontent.com/eryk/blog_img/master/2.png" alt=""></p>
<p>介绍常用的几个指标：</p>
<ul>
<li>Annual return：年化回报率</li>
<li>Cumulative returns: 累计收益率，是策略从开始执行到结束的总资产收益率。</li>
<li>Annual volatility：年化波动率</li>
<li>Sharpe ratio：夏普比率，一种非常流行的风险指标。它表示每单位风险（通过标准差衡量）的超额收益（超过无风险利率）。</li>
<li>Sortino ratio: 索提诺比率，Sharpe比率的修改版本，其中标准偏差由下行偏差代替。下行偏差仅衡量该系列的负波动性，严格来说是在称为最低可接受收益的预定水平以下。</li>
<li>Maximum drawdown ：最大跌幅—指示峰和谷之间的最大跌幅（以％表示）</li>
<li>Tail ratio：对daily return的分布选取95分位和5分位，然后相除取绝对值。本质的含义就是赚取的return比亏钱的大多少倍。</li>
<li>Daily value at risk（daily Value-at-Risk ）<br>
每日风险价值-另一个非常流行的风险指标。在这种情况下，这表明在95％的情况下，将头寸（投资组合）再保留1天，损失不会超过2.3％。</li>
</ul>
<p>下图从各个角度对资产回报进行更详细的图表展示</p>
<p><img src="https://raw.githubusercontent.com/eryk/blog_img/master/3.png" alt=""></p>
<h3 id="参考">参考</h3>
<p><a href="https://quantopian.github.io/pyfolio/" target="_blank" rel="noopener">https://quantopian.github.io/pyfolio/</a><br>
<a href="https://zhuanlan.zhihu.com/p/118108419" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/118108419</a><br>
<a href="https://towardsdatascience.com/the-easiest-way-to-evaluate-the-performance-of-trading-strategies-in-python-4959fd798bb3" target="_blank" rel="noopener">https://towardsdatascience.com/the-easiest-way-to-evaluate-the-performance-of-trading-strategies-in-python-4959fd798bb3</a></p>

      

<img src="https://eryk.github.io/uploads/gzh.jpg"  alt="Python量化交易实战" /><center>欢迎您扫码订阅我的微信公众号: pyquant</center>
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Author"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">Author</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/eryk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;eryk" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.weibo.com/eryk86" title="Weibo → https:&#x2F;&#x2F;www.weibo.com&#x2F;eryk86" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Author</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


</body>
</html>
